# Development Sandbox

The development sandbox serves as an isolated environment for local development and testing, separate from the live system. This setup grants full control over local data and mock interfaces.

## Getting Started

1. To begin with, duplicate the `.env.example` file and name it either `.env` or `.env.local` to set the default local environment variable in your local environment.

2. Switch to localdev folder

```bash
cd localdev
```

3. Create two directories to mount volumns for `mongodb` and `postgres`.

```bash
mkdir -p ./mnt/mongodb
mkdir -p ./mnt/postgres
```

If you have data version conflict errors due to existing mount volumes, please delete the directories and recreate them.

4. (For Mac M1 only) Set default platform of the docker commands:

```bash
export DOCKER_DEFAULT_PLATFORM=linux/arm64
```

5. Set environment variable MACHINE_HOST_IP to your ip address using the command

For WSL/Linux:

```bash
export MACHINE_HOST_IP=$(hostname -I | awk '{print $1}')
```

or
For Mac M1/M2:

```bash
export MACHINE_HOST_IP=$(ipconfig getifaddr en0)
```

6. To create the sandbox environment, utilize local Docker container instances with `docker-compose`:

For WSL/Linux:

```bash
docker-compose up --build [-d]
```

or
For Mac M1/M2:

```bash
docker-compose -f docker-compose-arm64 up --build [-d]
```

You can add the `-d` flag to run the containers in daemon mode.

## Services

Within the local Docker container context, `5 services` are established:

1. `Keycloak`: Facilitates user authentication for the application via Browser Login.
2. `Keycloak Provision`: Provisions the local Keycloak's realm, clients, and users.
3. `Postgres`: Serves as the database for Keycloak.
4. `MongoDB`: Serves as the database for the local application.
   - Please refer to [MongoDB Compass](https://www.mongodb.com/products/tools/compass) to explore the local database.
5. `Microsoft 365 Developer Proxy`: Serves as a proxy server for Microsoft Graph APIs.
   - Please refer to https://github.com/microsoft/m365-developer-proxy for more detailed information.

- Please refer to [docker-compose.yml](./docker-compose.yml) for more detailed information.

### Important Information

- `Keycloak HTTP`: http://localhost:8080
- `Keycloak HTTPS`: https://localhost:8443
- `Keycloak Realm`: platform-services
- `Keycloak Client ID`: pltsvc
- `Keyclaok Client Secret`: testsecret
- `MongoDB URL`: mongodb@localhost:27017
- `Microsoft 365 Proxy Url`: http://localhost:8000
- Please refer to [.env.example](../.env.example) for comprehensive local environment values.
- Please refer to [m365proxy/responses.json](./m365proxy/responses.json) for local mock user list.
  - The passwords for users are generated by converting their emails to lowercase.
